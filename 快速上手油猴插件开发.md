æ’ä»¶å¼€å‘è®­ç»ƒè¥ä½ èƒ½å¤Ÿå­¦ä¹ åˆ°ï¼š

1. å¿«é€Ÿä½¿ç”¨æ²¹çŒ´æ’ä»¶è¿›è¡Œæµè§ˆå™¨æ’ä»¶å¼€å‘
2. ç”¨wokkoè„šæ‰‹æ¶å¼€å‘1ä¸ªæœ‰æ„æ€çš„æ’ä»¶: åˆ’è¯æœç´¢[MoveSearch](https://greasyfork.org/zh-CN/scripts/421189-movesearch) 
3. æœ‰ç²¾åŠ›çš„è¯å¯ä»¥ç»§ç»­å­¦ä¹ [wokooè„šæ‰‹æ¶çš„æ­å»º](https://gitee.com/zhufengpeixun/browser-plugin/blob/master/wokoo%E8%84%9A%E6%89%8B%E6%9E%B6(%E6%90%AD%E5%BB%BA%E7%AF%87).md)ã€‚

## ä¸ºä»€ä¹ˆè¦å­¦ä¹ æµè§ˆå™¨æ’ä»¶å¼€å‘

æµè§ˆå™¨æ’ä»¶å¼€å‘æœ‰çš„åŒå­¦å¯èƒ½æ¥è§¦çš„ä¸å¤šï¼Œæˆ–è€…æœ‰ç–‘é—®ï¼Œå­¦ä¹ å¼€å‘æµè§ˆå™¨æ’ä»¶æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¿™é‡Œæˆ‘åˆ—ä¸¾ä¸€äº›å·¥ä½œä¸­çš„åœºæ™¯ï¼š

åœºæ™¯1ï¼š

å‘Šè­¦å¹³å°æ”¶åˆ°æŸä¸ªå‰ç«¯é¡¹ç›®çš„å‘Šè­¦æ—¥å¿—ï¼Œä¸ºäº†å¤ç°å®šä½é—®é¢˜ï¼Œéœ€è¦ç™»å½•æŸä¸ªè´¦å·å†…è¿›è¡ŒæŸ¥çœ‹ã€‚æ­¤æ—¶rdéœ€è¦è”ç³»äº§å“åŒå­¦ï¼Œè®©äº§å“åŒå­¦è”ç³»å¯¹åº”çš„ç”¨æˆ·ï¼Œè®©ç”¨æˆ·æä¾›è´¦å·å¯†ç ç»™rdã€‚æ­¤æµç¨‹å¾ˆé•¿ï¼Œè€Œä¸”ç»™ç”¨æˆ·é€ æˆä¸å¥½çš„å°è±¡ã€‚è€Œå¦‚æœå…¬å¸å†…éƒ¨æ”¯æŒå…å¯†ç™»å½•ï¼Œåªæ˜¯éœ€è¦æ‹¼æ¥ä¸€ä¸ªç‰¹å®šçš„urlï¼Œurlè§„åˆ™æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦æœ‰è´¦å·idç­‰ä¿¡æ¯ã€‚æ­¤æ—¶å¦‚æœå°†æ‹¼æ¥è§„åˆ™å†™åˆ°æ’ä»¶é‡Œï¼Œæ’ä»¶æä¾›ä¸€ä¸ªæŒ‰é’®å°±èƒ½å¤Ÿè·³è½¬åˆ°å¯¹åº”çš„ç”¨æˆ·è´¦å·ä¸­ï¼Œæ˜¯ä¸æ˜¯é™ä½äº†rdçš„å·¥ä½œé‡ï¼Ÿ

åœºæ™¯2ï¼š

å½“æµ‹è¯•çš„åŒå­¦å‘ç°é—®é¢˜æ—¶ï¼Œéœ€è¦æˆªå›¾ï¼Œæ‰“å¼€æµ‹è¯•å¹³å°ï¼Œå¡«å†™å…·ä½“çš„é—®é¢˜ï¼Œæäº¤æµ‹è¯•æŠ¥å‘Šã€‚å¦‚æœèƒ½æœ‰æ’ä»¶åœ¨å½“å‰é¡µé¢ä¸­å¼¹å‡ºè¦å¡«å†™çš„æµ‹è¯•è¡¨å•ï¼Œæ˜¯ä¸æ˜¯å°±å‡å°‘äº†æµ‹è¯•åŒå­¦çš„å·¥ä½œæµç¨‹ï¼Ÿ

**å­¦ä¼šäº†æµè§ˆå™¨æ’ä»¶å¼€å‘åï¼Œå¯ä»¥åšä¸€äº›å·¥ä½œåœºæ™¯ç›¸å…³çš„æ’ä»¶ï¼Œæ¥å¸®åŠ©è‡ªå·±ä»¥åŠåŒäº‹æé«˜æ•ˆç‡ã€‚è¿™ä¸ç®¡æ˜¯è¿°èŒæ™‹å‡è¿˜æ˜¯è·³æ§½æ¢å·¥ä½œéƒ½ä¼šæ˜¯ä¸€ä¸ªåŠ åˆ†çš„äº®ç‚¹ã€‚**



## æ­£å¼å¼€å§‹æ’ä»¶å¼€å‘

#### ä¸€ã€åˆ’è¯æœç´¢MoveSearch

#### **æˆå“å±•ç¤º**

![movesearch](https://gitee.com/zhufengpeixun/browser-plugin/raw/master/img/movesearch.gif)

å®‰è£…åœ°å€ï¼š

1. å®‰è£…[æ²¹çŒ´æ’ä»¶](https://chrome.google.com/webstore/detail/tampermonkey-beta/gcalenpjmijncebpfijmoaglllgpjagf?hl=zh-CN)
2. å®‰è£…[MoveSearch](https://greasyfork.org/zh-CN/scripts/421189-movesearch)

ä»£ç åœ°å€ï¼š[wokoo/example/MoveSearch](https://github.com/kinyaying/wokoo/tree/master/example/MoveSearch)

#### **å¼€å‘æ­¥éª¤**

##### 1.1 é¡¹ç›®å®‰è£… & åˆå§‹åŒ–é…ç½®

```shell
npm i wokoo -g
wokoo MoveSearch
```

é€‰æ‹©æ¨¡æ¿

- [ ] vue
- [ ] react

è¿™é‡Œé€‰æ‹©react

å®‰è£…å®Œæˆåï¼Œå‡ºç°å®‰è£…æˆåŠŸçš„ç•Œé¢

![npm-succeed](https://gitee.com/zhufengpeixun/browser-plugin/raw/master/img/npm-succeed.png)

æ ¹æ®æç¤ºæ‰§è¡Œä¸‹å‘½ä»¤

```shell
cd MoveSearch
npm start
```

- æ‰“å¼€æ²¹çŒ´è„šæœ¬ç¼–è¾‘å™¨ï¼ŒæŠŠtampermonkey.jsçš„å†…å®¹å¤åˆ¶è¿›å»ã€‚

  ![tampermonkey](https://gitee.com/zhufengpeixun/browser-plugin/raw/master/img/tampermonkey.png)

  ![copy-tampermonkey](https://gitee.com/zhufengpeixun/browser-plugin/raw/master/img/copy-tampermonkey.png)

- æ‰“å¼€ç½‘é¡µ[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/searchPage?wd=%E6%B2%B9%E7%8C%B4%E6%8F%92%E4%BB%B6)ï¼Œå³ä¸Šè§’å‡ºç°çŒ´å­çš„logoï¼Œè¯´æ˜ç¯å¢ƒè·‘é€š

##### 1.2 å®ç°åŸºæœ¬åŠŸèƒ½

å…ˆæ•´ç†ä¸€ä¸‹æ€è·¯ï¼Œè¦å®ç°åˆ’è¯æœç´¢åŠŸèƒ½ï¼Œä¸»è¦å®ç°ä»¥ä¸‹æ­¥éª¤ï¼š

1. ç›‘å¬mouseupäº‹ä»¶ï¼Œè§¦å‘æ—¶æ£€æŸ¥æ˜¯å¦æœ‰æ–‡å­—è¢«é€‰ä¸­ï¼Œå¦‚æœæœ‰åˆ™å¼¹çª—å±•ç¤º
2. å¼¹çª—å±•ç¤ºå‰å‘è¯·æ±‚åˆ°baidukaifaçš„æ¥å£ï¼Œè·å–æœç´¢å†…å®¹
3. å¦‚æœæœç´¢å†…å®¹ä¸ä¸ºç©ºï¼Œå°†å†…å®¹å±•ç¤ºåˆ°å¼¹çª—ä¸­
4. è¾¹ç•Œæ£€æµ‹ï¼Œç‚¹å‡»å¼¹çª—åŒºåŸŸå¤–çš„å†…å®¹ï¼Œå¼¹çª—å…³é—­

æ­¤å¤„æœ‰ä¸ªéš¾ç‚¹ï¼Œå°±æ˜¯baiduçš„[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/searchPage)æ¥å£ä¸å…è®¸è·¨åŸŸï¼Œæ¯”å¦‚åœ¨æ˜é‡‘çš„ç½‘é¡µä¸­å»è¯·æ±‚[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/rest/v1/search?query=html&pageNum=1&pageSize=10)çš„æ¥å£ä¼šè¢«æ‹¦ä½ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä½¿ç”¨[vercel](https://vercel.com/dashboard)æä¾›çš„serverlessæœåŠ¡åšäº†ä¸€æ¬¡ä»£ç†ï¼Œåœ¨ä»£ç†ä¸­ç»™å“åº”å¤´å¢åŠ äº†`Access-Control-Allow-Origin`ç­‰å­—æ®µï¼Œå¼€å¯è·¨åŸŸã€‚å…·ä½“æ–¹æ³•åœ¨**1.3**ç»™å‡ºï¼Œæ­¤æ—¶æˆ‘ä»¬å…ˆåœ¨[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/searchPage)é¡µé¢é‡Œé¢è¿›è¡Œå¼€å‘ï¼Œå…ˆä¿è¯æ˜¯åŒåŸŸä¸‹ã€‚

**æ­¥éª¤1. ç›‘å¬mouseupäº‹ä»¶ï¼Œè§¦å‘æ—¶æ£€æŸ¥æ˜¯å¦æœ‰æ–‡å­—è¢«é€‰ä¸­**

ç¼–è¾‘`/src/app.js`æ–‡ä»¶ï¼Œå¢åŠ å¯¹mouseupçš„ç›‘å¬ï¼š

```js
import React from 'react'
import axios from 'axios'
import './app.less'

export default class extends React.Component {
  constructor(props) {
    super(props)
    this.state = { show: false }
  }
  componentDidMount() {
    document.addEventListener('mouseup', (e) => {
      var selectionObj = window.getSelection()
      var selectedText = selectionObj.toString()
      console.log('selectedText', selectedText)
    })
  }

  render() {
    let { show } = this.state
    return <>{show ? <div className="Wokoo"></div> : null}</>
  }
}
```

**æ­¥éª¤2. å¼¹çª—å±•ç¤ºå‰å‘è¯·æ±‚åˆ°[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/rest/v1/search?query=html&pageNum=1&pageSize=10)çš„æ¥å£ï¼Œè·å–æœç´¢å†…å®¹**

- å®‰è£…axiosï¼Œå¼•å…¥axios
- å¯¹componentDidMountå†…çš„ä»£ç è¿›è¡Œæ”¹é€ ï¼Œè¯·æ±‚[å¼€å‘è€…æœç´¢](https://kaifa.baidu.com/rest/v1/search?query=html&pageNum=1&pageSize=10) è·å–æœç´¢ç»“æœ

```js
componentDidMount() {
    document.addEventListener('mouseup', (e) => {
      var selectionObj = window.getSelection()
      var selectedText = selectionObj.toString()
      console.log('selectionObj::', selectedText)
      if (selectedText.length === 0) {
      } else {
        axios
          .get(
            `https://kaifa.baidu.com/rest/v1/search?query=${selectedText}&pageNum=1&pageSize=10`
          )
          .then((res) => {
            let { data } = res.data.data.documents
            console.log(data)
            if (data.length) {
              this.setState({
                data: data,
                show: true,
              })
            }
          })
      }
    })
  }
```

- ä¿®æ”¹renderï¼Œå±•ç¤ºæœç´¢ç»“æœ

```js
render() {
    let { show, data } = this.state
    return (
      <>
        {show ? (
          <div className="Wokoo">
            <ul>
              {data.map((i) => (
                <li>{i.title}</li>
              ))}
            </ul>
          </div>
        ) : null}
      </>
    )
  }
```

æ­¤æ—¶ï¼Œç½‘é¡µä¸­èƒ½å¤Ÿçœ‹åˆ°æœç´¢çš„ç»“æœäº†ï¼ŒåŸºæœ¬åŠŸèƒ½æå®šäº†ã€‚

![step1](https://gitee.com/zhufengpeixun/browser-plugin/raw/master/img/step1.png)

**æ­¥éª¤3. è®¡ç®—å¼¹çª—å‡ºç°çš„ä½ç½®ï¼Œè®©å¼¹çª—å‡ºç°åœ¨é€‰ä¸­æ–‡å­—ä¸‹æ–¹**

![wokooå¼€å‘](https://gitee.com/zhufengpeixun/browser-plugin/raw/master/img/wokooå¼€å‘.png)

![wokooå¼€å‘çš„å‰¯æœ¬](https://gitee.com/zhufengpeixun/browser-plugin/raw/master/img/wokooå¼€å‘çš„å‰¯æœ¬.png)

æˆ‘ä»¬å¯ä»¥å¾—å‡ºè®¡ç®—å…¬å¼ä¸ºï¼š

> left = x + width/2 - MODAL_WIDTH/2
>
> top = y + height

æ­¤æ—¶ï¼Œ`app.js`çš„ä»£ç è¢«æ”¹é€ æˆè¿™æ ·ï¼š

```js
import React from 'react'
import axios from 'axios'
import './app.less'
const MODAL_WIDTH = 350
export default class extends React.Component {
  constructor(props) {
    super(props)
    this.state = { show: false, data: [] }
  }
  componentDidMount() {
    document.addEventListener('mouseup', (e) => {
      var selectionObj = window.getSelection()
      var selectedText = selectionObj.toString()
      if (selectedText.length === 0) {
      } else {
        var selectionObjRect = selectionObj
          .getRangeAt(0)
          .getBoundingClientRect()
        let { x, y, height, width } = selectionObjRect // è·å–é€‰ä¸­æ–‡å­—çš„ä½ç½®ï¼Œx yæ˜¯æ¨ªçºµåæ ‡ï¼Œheight widthæ˜¯é€‰ä¸­æ–‡å­—çš„é«˜åº¦å’Œå®½åº¦
        // è®¡ç®—å¼¹çª—ä½ç½®ï¼Œç®—å‡ºleftå’Œtop
        var left = x - MODAL_WIDTH / 2 + width / 2
        left = left > 10 ? left : 10
        var top = y + height
        var scrollLeft =
          document.documentElement.scrollLeft || document.body.scrollLeft
        var scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop
        axios
          .get(
            `https://kaifa.baidu.com/rest/v1/search?query=${selectedText}&pageNum=1&pageSize=10`
          )
          .then((res) => {
            let { data } = res.data.data.documents
            if (data.length) {
              this.setState({
                data,
                show: true,
                selectedText: selectedText,
                modalPosition: {
                  left: left + scrollLeft,
                  top: top + scrollTop,
                },
              })
            }
          })
      }
    })
  }

  render() {
    let { show, selectedText, modalPosition, data } = this.state
    return (
      <>
        {show && data && data.length ? (
          <div
            className="move-search"
            id="MoveSearchApp"
            style={{
              ...modalPosition,
            }}
          >
            <div className="move-search-content">
              <ul className="move-search-ul">
                {data.map((l) => (
                  <li className="move-search-li" key={l.id}>
                    <a href={l.url} target="_blank">
                      {l.title}
                    </a>
                    <span>{l.summary}</span>
                  </li>
                ))}
              </ul>
            </div>
            <div className="move-search-bottom-fade"></div>
            <footer className="move-search-footer">
              <a
                href={`https://kaifa.baidu.com/searchPage?wd=${selectedText}`}
                target="_blank"
              >
                Read More
              </a>
            </footer>
          </div>
        ) : null}
      </>
    )
  }
}

```

åˆ«å¿˜äº†å¢åŠ æ ·å¼ï¼Œä¿®æ”¹app.less

```css
.move-search {
  position: absolute;
  text-align: center;
  width: 350px;
  max-height: 300px;
  top: 0;
  right: 0;
  border-radius: 5px;
  z-index: 2147483647;
  box-shadow: rgba(0, 0, 0, 0.2) 0px 16px 100px 0px;
  transition: all 0.1s ease-out 0s;
  border: 1px solide #282a33;
  background: #fff;
  font-size: 12px;
  overflow: scroll;
  text-align: left;
}
```

**æ­¥éª¤4. è¾¹ç•Œæ£€æµ‹ï¼Œç‚¹å‡»å¼¹çª—å¤–éƒ¨ï¼Œå¼¹çª—éšè—**

![wokooå¼€å‘çš„å‰¯æœ¬ 2](https://gitee.com/zhufengpeixun/browser-plugin/raw/master/img/wokoo%E5%BC%80%E5%8F%91%E7%9A%84%E5%89%AF%E6%9C%AC%202.png)

è¾¹ç•Œæ£€æµ‹çš„åˆ¤æ–­æ¡ä»¶å¦‚ä¸‹ï¼š

> left+width > x > left && top+height > y > top

```js
function boundaryDetection(x, y, modalPosition = { left: 0, top: 0 }) {
  let { left, top } = modalPosition
  if (
    x > left &&
    x < left + MODAL_WIDTH &&
    y > top &&
    y < top + MoveSearchApp.offsetHeight
  ) {
    return true
  }
  return false
}
```

ä¿®æ”¹`app.js`å¢åŠ å¼¹çª—æ¶ˆå¤±çš„é€»è¾‘ï¼Œåœ¨selectedTextä¸ºç©ºæ—¶åˆ¤æ–­é¼ æ ‡ä½ç½®æ˜¯å¦åœ¨å¼¹çª—å†…ã€‚

```js
import React from 'react'
import axios from 'axios'
import './app.less'
// å¼¹çª—å®½åº¦
const MODAL_WIDTH = 350
/**
 * è¾¹ç•Œæ£€æµ‹ï¼Œé¼ æ ‡ç‚¹å‡»modalä¹‹å¤–ï¼Œmodaléšè—
 * @param {*} x é¼ æ ‡çš„xè½´ä½ç½®
 * @param {*} y é¼ æ ‡çš„yè½´ä½ç½®
 * @param {*} modalPosition å¼¹çª—çš„leftå’Œtop
 */
function boundaryDetection(x, y, modalPosition = { left: 0, top: 0 }) {
  let { left, top } = modalPosition
  if (
    x > left &&
    x < left + MODAL_WIDTH &&
    y > top &&
    y < top + MoveSearchApp.offsetHeight
  ) {
    return true
  }
  return false
}
export default class extends React.Component {
  constructor(props) {
    super(props)
    this.state = { show: false, data: [] }
  }
  componentDidMount() {
    document.addEventListener('mouseup', (e) => {
      var selectionObj = window.getSelection()
      var selectedText = selectionObj.toString()
      if (selectedText.length === 0) {
        if (this.state.show) {
          // é‡æ–°è®¡ç®—æ˜¯å¦å…³é—­å¼¹çª—
          // æ£€æµ‹é¼ æ ‡ä½ç½®æ˜¯å¦åœ¨å¼¹çª—å†…ï¼Œä¸æ˜¯åˆ™å…³é—­å¼¹çª—
          var inModal = boundaryDetection(
            e.clientX,
            e.clientY,
            this.state.modalPosition
          )
          if (!inModal) {
            this.setState({
              show: false,
              data: [],
            })
          }
        }
      } else {
        var selectionObjRect = selectionObj
          .getRangeAt(0)
          .getBoundingClientRect()
        let { x, y, height, width } = selectionObjRect // è·å–é€‰ä¸­æ–‡å­—çš„ä½ç½®ï¼Œx yæ˜¯æ¨ªçºµåæ ‡ï¼Œheight widthæ˜¯é€‰ä¸­æ–‡å­—çš„é«˜åº¦å’Œå®½åº¦
        // è®¡ç®—å¼¹çª—ä½ç½®ï¼Œç®—å‡ºleftå’Œtop
        var left = x - MODAL_WIDTH / 2 + width / 2
        left = left > 10 ? left : 10
        var top = y + height
        var scrollLeft =
          document.documentElement.scrollLeft || document.body.scrollLeft
        var scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop
        axios
          .get(
            `https://kaifa.baidu.com/rest/v1/search?query=${selectedText}&pageNum=1&pageSize=10`
          )
          .then((res) => {
            let { data } = res.data.data.documents
            if (data.length) {
              this.setState({
                data,
                show: true,
                selectedText: selectedText,
                modalPosition: {
                  left: left + scrollLeft,
                  top: top + scrollTop,
                },
              })
            }
          })
      }
    })
  }

  render() {
    let { show, selectedText, modalPosition, data } = this.state
    return (
      <>
        {show && data && data.length ? (
          <div
            className="move-search"
            id="MoveSearchApp"
            style={{
              ...modalPosition,
            }}
          >
            <div className="move-search-content">
              <ul className="move-search-ul">
                {data.map((l) => (
                  <li className="move-search-li" key={l.id}>
                    <a href={l.url} target="_blank">
                      {l.title}
                    </a>
                    <span>{l.summary}</span>
                  </li>
                ))}
              </ul>
            </div>
            <div className="move-search-bottom-fade"></div>
            <footer className="move-search-footer">
              <a
                href={`https://kaifa.baidu.com/searchPage?wd=${selectedText}`}
                target="_blank"
              >
                Read More
              </a>
            </footer>
          </div>
        ) : null}
      </>
    )
  }
}
```

æ­¤æ—¶ï¼Œé¡¹ç›®çš„åŸºæœ¬åŠŸèƒ½å·²ç»å¼€å‘å®ŒæˆğŸ‰ï¼Œä¸€äº›æ ·å¼é—®é¢˜å¯ä»¥è‡ªè¡Œè°ƒæ•´ã€‚

å…·ä½“çš„ä»£ç é€»è¾‘å¯çœ‹githubåœ°å€ï¼š[MoveSearch](https://github.com/kinyaying/wokoo/tree/master/example/MoveSearch)

### 1.3 è§£å†³è·¨åŸŸé—®é¢˜

ç™¾åº¦çš„æ¥å£ä¸å…è®¸è·¨åŸŸè®¿é—®ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªç¬¬ä¸‰æ–¹é¡µé¢ï¼Œæ¯”å¦‚cdnï¼Œæ˜é‡‘ç­‰çš„ç½‘é¡µé‡Œï¼Œè¦è®¿é—®ç™¾åº¦çš„æ¥å£å°±å­˜åœ¨è·¨åŸŸé™åˆ¶ï¼Œæ²¡æ³•è®¿é—®ã€‚æˆ‘é‡‡ç”¨å¢åŠ nodeä¸­é—´å±‚ï¼Œåœ¨nodeä¸­ç»™å“åº”å¢åŠ `Access-Control-Allow-Origin`è¯·æ±‚å¤´çš„æ–¹å¼å¼€å¯è·¨åŸŸã€‚

ç›®å‰æœ‰ç°æˆçš„æä¾›serverlessæœåŠ¡çš„ç¬¬ä¸‰æ–¹å‚å®¶ï¼Œæä¾›æœåŠ¡å™¨ï¼Œnodeç¯å¢ƒç­‰æœåŠ¡ï¼Œæˆ‘ä»¬åªè¦å…³å¿ƒnodeçš„ä»£ç é€»è¾‘å³å¯ï¼Œéƒ¨ç½²æœåŠ¡å™¨é…ç½®ç¯å¢ƒç­‰é—®é¢˜äº¤ç»™ç¬¬ä¸‰æ–¹å‚å®¶è§£å†³ã€‚æˆ‘é‡‡ç”¨[vercel](https://vercel.com/dashboard)æä¾›çš„æœåŠ¡ã€‚

ä¸‹é¢çš„å†…å®¹å’Œæ’ä»¶å¼€å‘å…³ç³»ä¸å¤§ï¼Œå¦‚æœä¸æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘é…ç½®å¥½çš„åŸŸåï¼š`https:/movesearch.vercel.app/api/baidu`ã€‚ä¹Ÿå°±æ˜¯å°†ä»£ç ä¸­axiosè¯·æ±‚çš„urlç”±`https://kaifa.baidu.com/rest/v1/search?query=${selectedText}&pageNum=1&pageSize=10`æ›¿æ¢æˆ`https:/movesearch.vercel.app/api/baidu?query=${selectedText}&pageNum=1&pageSize=10`å°±å¯ä»¥äº†ã€‚

å¦‚æœå¯¹äºå¦‚ä½•å®ç°è·¨åŸŸé…ç½®æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ğŸ‘‡ã€‚

1. ç™»å½•[vercel](https://vercel.com/dashboard)å®˜ç½‘ï¼Œæ ¹æ®æç¤ºç»‘å®šgithubè´¦å·ï¼›
2. ç‚¹å‡»æ–°å»ºnexté¡¹ç›®ã€‚vercelä¼šè‡ªåŠ¨ç»™ä½ çš„githubä¸Šåˆ›å»ºæ–°çš„ä»“åº“ï¼Œå¹¶æœ‰ä¸€ä¸ªåˆå§‹åŒ–é¡¹ç›®ï¼›
3. git clone æ­¤é¡¹ç›®åˆ°æœ¬åœ°ï¼Œæ ¹æ®readmeçš„æç¤ºï¼Œæ‰§è¡Œ`npm run dev`ï¼Œå¯åŠ¨é¡¹ç›®
4. å¢åŠ `src/api/baidu.js`æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œ`src/api/baidu.js`ä¸‹çš„æ–‡ä»¶å¯¹åº”çš„å°±æ˜¯`/api/baidu`æ¥å£

```js
const { createProxyMiddleware } = require('http-proxy-middleware')

// restream parsed body before proxying
var restream = function (proxyRes, req, res, options) {
  proxyRes.headers['Access-Control-Allow-Origin'] = '*'
  proxyRes.headers['Access-Control-Allow-Headers'] = '*'
  proxyRes.headers['Access-Control-Allow-Methods'] = 'GET, POST, PUT, OPTIONS'
}

const apiProxy = createProxyMiddleware({
  target: 'https://kaifa.baidu.com/',
  changeOrigin: true,
  pathRewrite: { '^/api/baidu': '/rest/v1/search' },
  secure: false,
  onProxyRes: restream,
})

module.exports = function (req, res) {
  apiProxy(req, res, (result) => {
    console.log('result:', result)
    if (result instanceof Error) {
      throw result
    }
    throw new Error(
      `Request '${req.url}' is not proxied! We should never reach here!`
    )
  })
}
```

å…·ä½“çš„ä»£ç é€»è¾‘å¯çœ‹githubåœ°å€ï¼š[nextjs](https://github.com/kinyaying/nextjs)

#### ä¸‰ã€wokooè„šæ‰‹æ¶çš„æ­å»º

æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥é˜…è¯» [wokooè„šæ‰‹æ¶ï¼ˆæ­å»ºç¯‡ï¼‰](https://gitee.com/zhufengpeixun/browser-plugin/blob/master/wokoo%E8%84%9A%E6%89%8B%E6%9E%B6(%E6%90%AD%E5%BB%BA%E7%AF%87).md)

